/* ==========================================================================
   Piano Roll V2 - Ana Stil Dosyası (Temizlenmiş ve Optimize Edilmiş)
   Dosya: /src/features/piano_roll_v2/styles/PianoRoll.css
   ========================================================================== */

/* ==========================================================================
   1. Ana Konteyner ve Layout
   ========================================================================== */
   .prv2-container {
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
    color: var(--color-text-primary);
    overflow: hidden;
    position: relative;
    font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
    contain: strict; /* Performans için ana konteyneri izole et */
  }
  
  .prv2-layout-grid {
    flex-grow: 1;
    min-height: 0;
    display: grid;
    grid-template-rows: 32px 1fr auto;
    grid-template-columns: 80px 1fr;
    contain: layout style;
  }
  
  .prv2-corner {
    grid-row: 1; 
    grid-column: 1;
    background-color: var(--color-surface-1);
    border-right: 1px solid var(--color-background);
    border-bottom: 1px solid var(--color-background);
    z-index: 30;
  }
  
  /* ==========================================================================
     2. Toolbar
     ========================================================================== */
  .prv2-toolbar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--spacing-2) var(--spacing-4);
    background-color: var(--color-surface-1);
    border-bottom: 1px solid var(--color-background);
    flex-shrink: 0;
  }
  
  .prv2-tool-group {
    display: flex;
    align-items: center;
    gap: var(--spacing-2);
  }
  
  .prv2-tool-group__icon { 
    color: var(--color-text-secondary); 
  }
  
  .prv2-toolbar-btn {
    display: flex; 
    align-items: center; 
    justify-content: center;
    width: 32px; 
    height: 32px;
    border-radius: var(--border-radius-sm);
    background-color: var(--color-surface-2);
    color: var(--color-text-secondary);
    transition: all var(--transition-speed);
  }
  
  .prv2-toolbar-btn:hover {
    background-color: var(--color-surface-3);
    color: var(--color-text-primary);
  }
  
  .prv2-toolbar-btn--active {
    background-color: var(--color-accent-primary);
    color: var(--color-text-inverse);
    box-shadow: var(--shadow-glow);
  }
  
  .prv2-toolbar-select {
    background-color: var(--color-surface-2);
    color: var(--color-text-primary);
    border: 1px solid var(--color-border);
    border-radius: var(--border-radius-sm);
    padding: var(--spacing-1) var(--spacing-2);
    font-size: var(--font-size-sm);
    outline: none;
  }
  
  .prv2-toolbar-zoom-label {
    font-family: var(--font-mono);
    font-size: var(--font-size-sm);
    color: var(--color-text-secondary);
    width: 40px;
    text-align: center;
  }
  
  /* ==========================================================================
     3. Senkronize Alanlar (Cetvel ve Klavye)
     ========================================================================== */
  .prv2-ruler-container,
  .prv2-keyboard-container {
    overflow: hidden; /* Dışarı taşan içeriği gizle, kaydırmayı ana grid'e bırak */
    position: relative;
    background-color: var(--color-surface-1);
    z-index: 20;
  }
  
  /* Bu elemanlar, scrollSync.js tarafından transform ile hareket ettirilir */
  .timeline-ruler-content,
  .prv2-keyboard__content {
    position: relative;
    will-change: transform; 
  }
  
  /* ==========================================================================
     4. Klavye Tuşları
     ========================================================================== */
  .prv2-keyboard__key {
    position: absolute; /* Artık dikeyde de transform ile pozisyonlanacak */
    display: flex;
    align-items: center;
    padding: 0 8px;
    width: 100%;
    user-select: none;
    border-bottom: 1px solid rgba(0, 0, 0, 0.15);
    cursor: pointer;
    transition: all 150ms cubic-bezier(0.4, 0, 0.2, 1);
    overflow: hidden;
    contain: layout style;
    will-change: transform;
  }
  
  .prv2-keyboard__key--white {
    background: linear-gradient(to right, #f7fafc 0%, #edf2f7 50%, #e2e8f0 100%);
    color: #2d3748;
    border-right: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.8);
  }
  
  .prv2-keyboard__key--white:hover {
    background: linear-gradient(to right, #edf2f7 0%, #e2e8f0 50%, #cbd5e0 100%);
  }
  
  .prv2-keyboard__key--black {
    background: linear-gradient(to right, #1a202c 0%, #2d3748 50%, #4a5568 100%);
    color: #e2e8f0;
    padding-left: 16px;
    border-right: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.1);
  }
  
  .prv2-keyboard__key--black:hover {
    background: linear-gradient(to right, #2d3748 0%, #4a5568 50%, #718096 100%);
  }
  
  .prv2-keyboard__key--playing,
  .prv2-keyboard__key--white.prv2-keyboard__key--playing:hover {
    background: linear-gradient(135deg, #ff6b35 0%, #ff4500 100%) !important;
    color: white !important;
    box-shadow: 0 0 12px rgba(255, 107, 53, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.3) !important;
    transform: translateX(2px);
  }
  
  .prv2-keyboard__key--playing .prv2-keyboard__label {
    color: white;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
  }
  
  .prv2-keyboard__label {
    font-size: 10px;
    font-weight: 600;
    font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
    opacity: 0.8;
    pointer-events: none;
    letter-spacing: 0.02em;
  }
  
  /* ==========================================================================
     5. Ana Grid ve Kaydırma Alanı
     ========================================================================== */
  .prv2-grid-area-container {
    grid-column: 2;
    grid-row: 2 / span 2; /* Vurgu alanı açıkken de doğru yeri kaplaması için */
    overflow: auto;
    position: relative;
    z-index: 10;
    will-change: scroll-position;
    transform: translateZ(0); 
    scroll-behavior: auto;
    -webkit-overflow-scrolling: touch;
    contain: strict;
  }
  
  /* ==========================================================================
     6. Precision Grid (Arka Plan Çizgileri)
     ========================================================================== */
  .prv2-precision-grid-container {
    contain: strict;
  }
  
  .prv2-grid-line-vertical,
  .prv2-grid-line-horizontal,
  .prv2-grid-black-key-row {
    position: absolute;
    left: 0;
    top: 0;
    pointer-events: none;
    will-change: transform;
  }
  
  .prv2-grid-black-key-row {
    background-color: var(--color-background);
    z-index: 1;
  }
  
  .prv2-grid-line-vertical {
    width: 1px;
    background-color: var(--color-surface-3);
    z-index: 2;
  }
  
  .prv2-grid-line--beat {
    background-color: var(--color-border);
  }
  
  .prv2-grid-line--bar {
    width: 2px;
    background-color: var(--color-text-secondary);
    opacity: 0.5;
  }
  
  .prv2-grid-line-horizontal {
    height: 1px;
    background-color: var(--color-surface-3);
    z-index: 2;
  }
  
  /* ==========================================================================
     7. Notalar ve Etkileşimler
     ========================================================================== */
  .prv2-notes-container {
    position: absolute;
    inset: 0;
    z-index: 10;
    pointer-events: none;
    contain: layout style paint;
    will-change: transform;
    transform: translateZ(0);
  }
  
  .prv2-note {
    position: absolute;
    background: linear-gradient(135deg, var(--note-base-color, #4a9eff), color-mix(in srgb, var(--note-base-color, #4a9eff) 80%, #000));
    border: 1px solid color-mix(in srgb, var(--note-base-color, #4a9eff) 60%, #000);
    border-radius: 4px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.2);
    transition: all 150ms cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    align-items: center;
    padding: 0 6px;
    pointer-events: auto;
    min-height: 16px;
    overflow: hidden;
    cursor: pointer;
    contain: layout style;
  }
  
  .prv2-note--selected {
    background: linear-gradient(135deg, #ff6b35, #ff4500) !important;
    border: 2px solid #ffffff !important;
    box-shadow: 0 0 16px rgba(255, 107, 53, 0.6), 0 2px 8px rgba(0, 0, 0, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.3) !important;
    z-index: 15;
    transform: scale(1.02);
  }
  
  .prv2-note--preview {
    background: linear-gradient(135deg, rgba(74, 158, 255, 0.7), rgba(74, 158, 255, 0.5));
    border: 2px dashed #4a9eff;
    box-shadow: 0 0 12px rgba(74, 158, 255, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.2);
    z-index: 20;
  }
  
  .prv2-note--ghost {
    background: linear-gradient(135deg, var(--note-ghost-color, rgba(255, 255, 255, 0.15)), rgba(255, 255, 255, 0.05));
    border: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow: none;
    opacity: 0.6;
  }
  
  .prv2-note:hover:not(.prv2-note--selected):not(.prv2-note--ghost) {
    transform: translateY(-1px);
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4), 0 0 8px color-mix(in srgb, var(--note-base-color, #4a9eff) 50%, transparent), inset 0 1px 0 rgba(255, 255, 255, 0.3);
  }
  
  .prv2-note__resize-handle {
    position: absolute;
    top: 0; 
    right: -2px; 
    bottom: 0;
    width: 12px;
    cursor: ew-resize;
    z-index: 16;
    opacity: 0;
    transition: opacity 150ms ease;
    background: linear-gradient(to right, transparent 0%, rgba(255, 255, 255, 0.15) 50%, rgba(255, 255, 255, 0.25) 100%);
    border-radius: 0 4px 4px 0;
  }
  
  .prv2-note:hover .prv2-note__resize-handle {
    opacity: 1;
  }
  
  .prv2-note__resize-handle:hover {
    background: linear-gradient(to right, transparent 0%, rgba(255, 255, 255, 0.25) 50%, rgba(255, 255, 255, 0.4) 100%);
  }
  
  .prv2-note__resize-handle:active {
    background: linear-gradient(to right, transparent 0%, rgba(74, 158, 255, 0.4) 50%, rgba(74, 158, 255, 0.6) 100%);
  }
  
  .prv2-note__label {
    font-size: 10px;
    font-weight: 600;
    color: rgba(255, 255, 255, 0.9);
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.7);
    white-space: nowrap;
    text-overflow: ellipsis;
    pointer-events: none;
    user-select: none;
    /* --- GÖRSEL HATA DÜZELTMESİ --- */
    max-width: 100%;
    overflow: clip; /* 'ellipsis' yerine 'clip' kullanarak taşan kısmı keser */
  }
  
  /* Scroll optimizasyonu: Kaydırma sırasında geçişleri ve animasyonları kapat */
  .prv2-notes-container--scrolling .prv2-note,
  .prv2-note--no-transitions {
    transition: none !important;
    animation: none !important;
  }
  
  /* --- YENİ EKLENEN BÖLÜM --- */
  /* LOD - En Uzak Zoom Seviyesi ("Tick" Görünümü) */
  .prv2-note--overview {
    background: var(--color-primary) !important;
    border: none !important;
    box-shadow: none !important;
    border-radius: 0 !important;
    min-height: 0 !important; /* Yüksekliğin çok küçülmesine izin ver */
    min-width: 1px !important;  /* Genişliğin 1px'den az olmasını engelle */
  }
  /* --- YENİ EKLENEN BÖLÜM SONU --- */
  
  /* ==========================================================================
     8. Velocity Lane (Vurgu Alanı)
     ========================================================================== */
  .prv2-velocity-lane {
    grid-column: 2; /* Sadece grid alanında olsun */
    background-color: var(--color-surface-1);
    border-top: 1px solid var(--color-background);
    position: relative;
    overflow: hidden;
  }
  
  .prv2-velocity-label-area {
    grid-row: 3; 
    grid-column: 1;
    background-color: var(--color-surface-1);
    border-top: 1px solid var(--color-background);
    border-right: 1px solid var(--color-background);
    display: flex; 
    align-items: center; 
    justify-content: center;
    font-size: var(--font-size-sm); 
    font-weight: bold;
    color: var(--color-text-secondary);
  }
  
  .prv2-velocity-lane-content {
    position: relative;
    height: 100%;
    will-change: transform; /* scrollSync ile hareket edecek */
  }
  
  .prv2-velocity-bar {
    position: absolute;
    bottom: 0;
    height: 100%;
    display: flex;
    align-items: flex-end;
    justify-content: center;
    cursor: ns-resize;
    contain: layout style;
    will-change: transform;
  }
  
  .prv2-velocity-bar__bar {
    width: 60%;
    background-color: var(--color-accent-secondary);
    border-top-left-radius: 2px;
    border-top-right-radius: 2px;
    transition: background-color 100ms ease;
  }
  
  .prv2-velocity-bar:hover .prv2-velocity-bar__bar { 
    background-color: var(--color-primary); 
  }
  
  .prv2-velocity-bar__bar--selected {
    background-color: var(--color-primary);
    box-shadow: 0 0 8px var(--color-primary);
  }
  
  /* ==========================================================================
     9. Playhead (Oynatma Çubuğu)
     ========================================================================== */
  .prv2-playhead {
    position: absolute;
    top: 0;
    left: 0; 
    width: 2px;
    background-color: var(--color-primary);
    box-shadow: var(--shadow-glow);
    pointer-events: none;
    will-change: transform;
    z-index: 25;
    contain: layout style paint;
    transform: translateZ(0);
  }
  
  /* ==========================================================================
     10. Diğer (Placeholder vb.)
     ========================================================================== */
  .prv2-placeholder {
    display: flex; 
    flex-direction: column; 
    align-items: center; 
    justify-content: center;
    width: 100%; 
    height: 100%; 
    color: var(--color-text-secondary);
    background-color: var(--color-surface-1);
  }
  
  .prv2-placeholder__icon { 
    opacity: 0.5; 
    margin-bottom: var(--spacing-4); 
  }
  
  .prv2-placeholder__title { 
    font-size: var(--font-size-xl); 
    font-weight: bold; 
  }
  
  .prv2-placeholder__text { 
    font-size: var(--font-size-md); 
  }